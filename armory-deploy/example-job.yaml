# This is meant as an example of how the armory-workflow would be used as a job in a workflow.

  ci-armory-deploy:
    name: Deploy with Armory
    # if: github.ref == 'refs/heads/main'  # Only on main.
    runs-on: ubuntu-latest
    needs: [ci-get-version, ci-build-docker-images]
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Bake and Deploy
        id: bake-and-deploy
        uses: tesourohq/Tesouro-Github-Actions/armory-deploy@main
        with:
          armory-client-id: ${{ secrets.ARMORY_CLIENT_ID }}  # Provided as an org-level Secret
          armory-client-secret: ${{ secrets.ARMORY_CLIENT_SECRET }}  # Provided as an org-level Secret
          armory-yaml-path: /deployment/armory/armory-deployment.yaml  # The path from the project root
          prod-kustomize-path: ./deployment/kustomize/overlays/prod  # The path from the project root
          major-minor-patch: 1.1.11 # Pulled from the get-version action, it could look like this: ${{ needs.ci-get-version.outputs.MajorMinorPatch }}
          image-name: tesouro-service-reporting  # The base name of the image, not the repo or tag.
          image-tag: 1.1.11 # Pulled from the get-version action, it could look like this: ${{ needs.ci-get-version.outputs.MajorMinorPatch }}  # The tag for the image.